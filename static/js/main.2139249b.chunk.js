(this["webpackJsonpgist-tickets"]=this["webpackJsonpgist-tickets"]||[]).push([[0],{61:function(e,t,n){},71:function(e,t,n){},83:function(e,t,n){"use strict";n.r(t);var a=n(0),c=n.n(a),r=n(20),i=n.n(r),s=(n(71),n(8)),l=(n(60),n(51)),u=n(91),o=n(87),d=n(92),j=(n(61),n(66)),b=n(9),O=n.n(b),x=n(12),h=n(85),v=n(86),p=n(88),f=n(2),m=n(7),g=n(89),k=n(90),y=n(1),w=function(e){var t=e.user,n=e.onAdd,c=Object(a.useState)(""),r=Object(s.a)(c,2),i=r[0],l=r[1],u=Object(a.useState)(null),o=Object(s.a)(u,2),d=o[0],j=o[1],b=Object(a.useState)(""),p=Object(s.a)(b,2),w=p[0],N=p[1],S=Object(a.useState)(!1),T=Object(s.a)(S,2),L=T[0],I=T[1],A=Object(a.useState)(!1),q=Object(s.a)(A,2),z=q[0],B=q[1],D=Object(a.useState)("title"),E=Object(s.a)(D,2),_=E[0],F=E[1],J=function(){var e=Object(x.a)(O.a.mark((function e(a){var c;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.octokit.request("POST /gists",{description:a.title,files:Object(m.a)({},C,{content:JSON.stringify({number:a.number,content:a.content})}),public:!1});case 3:c=e.sent,n(Object(f.a)(Object(f.a)({},a),{},{id:c.data.id})),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),B(!0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}();return Object(y.jsxs)(g.a,{noValidate:!0,validated:L,onSubmit:function(e){e.preventDefault(),0===i.length?(F("title"),I(!0)):null===d||d<1?(F("number"),I(!0)):0===w.length?(F("content"),I(!0)):J({title:i,number:d,content:w})},children:[Object(y.jsxs)(k.a,{className:"mb-3",activeKey:_,onSelect:function(e){return F(null!==e&&void 0!==e?e:void 0)},children:[Object(y.jsxs)(k.a.Item,{eventKey:"title",children:[Object(y.jsx)(k.a.Header,{id:"AddTicket-title-label",children:"Tytu\u0142"}),Object(y.jsx)(k.a.Body,{children:Object(y.jsx)(g.a.Control,{type:"text",value:i,onChange:function(e){return l(e.target.value)},required:!0,"aria-labelledby":"AddTicket-title-label"})})]}),Object(y.jsxs)(k.a.Item,{eventKey:"number",children:[Object(y.jsx)(k.a.Header,{id:"AddTicket-number-label",children:"Numer"}),Object(y.jsx)(k.a.Body,{children:Object(y.jsx)(g.a.Control,{type:"number",value:null!==d&&void 0!==d?d:"",min:1,onChange:function(e){var t=parseInt(e.target.value,10);j(isNaN(t)?null:t)},required:!0,"aria-labelledby":"AddTicket-number-label"})})]}),Object(y.jsxs)(k.a.Item,{eventKey:"content",children:[Object(y.jsx)(k.a.Header,{id:"AddTicket-content-label",children:"Tre\u015b\u0107"}),Object(y.jsx)(k.a.Body,{children:Object(y.jsx)(g.a.Control,{as:"textarea",className:"AddTicket-content-textarea",value:w,onChange:function(e){return N(e.target.value)},required:!0,"aria-labelledby":"AddTicket-content-label"})})]})]}),z&&Object(y.jsx)(h.a,{variant:"danger",children:"Wyst\u0105pi\u0142 b\u0142\u0105d."}),Object(y.jsx)("div",{className:"text-center",children:Object(y.jsx)(v.a,{type:"submit",children:"Utw\xf3rz"})})]})},N=n(93),S=n(65),T=function(e){var t=e.tickets,n=e.onDelete;return Object(y.jsx)(N.a,{children:t.map((function(e){return Object(y.jsxs)(N.a.Item,{className:"List-item",children:[Object(y.jsxs)("div",{className:"List-item-header",children:[Object(y.jsxs)("h3",{children:[e.title," ",Object(y.jsxs)("span",{className:"List-item-number",children:["#",e.number]})]}),Object(y.jsx)(v.a,{onClick:function(){return n(e.id)},variant:"outline-dark","aria-label":"Usu\u0144",className:"List-item-delete",children:Object(y.jsx)(S.a,{})})]}),e.content.split("\n").map((function(e,t){return Object(y.jsxs)(c.a.Fragment,{children:[e,Object(y.jsx)("br",{})]},t)}))]},e.id)}))})},C="ticket.json",L=function(e){var t=e.user,n=Object(a.useState)("list"),c=Object(s.a)(n,2),r=c[0],i=c[1],l=Object(a.useState)([]),u=Object(s.a)(l,2),o=u[0],d=u[1],b=Object(a.useState)(null),f=Object(s.a)(b,2),m=f[0],g=f[1],k=t.octokit;return Object(a.useEffect)((function(){(function(){var e=Object(x.a)(O.a.mark((function e(){var t,n,a,c,r;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,k.request("GET /gists");case 3:return t=e.sent,n=t.data.filter((function(e){var t=Object.keys(e.files);return 1===t.length&&t[0]===C})),a=new Map(n.map((function(e){return[e.node_id,e.id]}))),e.next=8,k.graphql("\n                    query gists($node_ids: [ID!]!){\n                        nodes(ids: $node_ids) {\n                            ... on Gist {\n                                id\n                                description\n                                files (limit: 1) {\n                                    name\n                                    text\n                                }\n                            }\n                        }\n                    }\n                ",{node_ids:n.map((function(e){return e.node_id}))});case 8:c=e.sent,r=c.nodes,d(r.flatMap((function(e){var t,n,c,r,i=null===e||void 0===e||null===(t=e.files)||void 0===t?void 0:t[0];if("string"!==typeof(null===e||void 0===e?void 0:e.description))return[];if((null===i||void 0===i?void 0:i.name)!==C||"string"!==typeof(null===i||void 0===i?void 0:i.text))return[];try{r=JSON.parse(i.text)}catch(s){return[]}return"number"!==typeof(null===(n=r)||void 0===n?void 0:n.number)||"string"!==typeof(null===(c=r)||void 0===c?void 0:c.content)?[]:[{title:e.description,number:r.number,content:r.content,id:a.get(e.id)}]}))),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0),g("error");case 16:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(){return e.apply(this,arguments)}})()()}),[k]),Object(y.jsxs)("div",{children:["added"===m&&Object(y.jsx)(h.a,{variant:"success",children:"Dodano ticket."}),"deleted"===m&&Object(y.jsx)(h.a,{variant:"info",children:"Usuni\u0119to ticket."}),"error"===m&&Object(y.jsx)(h.a,{variant:"danger",children:"Wyst\u0105pi\u0142 b\u0142\u0105d."}),Object(y.jsx)("div",{className:"mb-3",children:Object(y.jsx)(v.a,{onClick:function(){return i("add")},children:"Utw\xf3rz"})}),Object(y.jsx)(T,{tickets:o,onDelete:function(){var e=Object(x.a)(O.a.mark((function e(t){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,k.request("DELETE /gists/{gist_id}",{gist_id:t});case 3:d(o.filter((function(e){return e.id!==t}))),g("deleted"),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),g("error");case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}()}),Object(y.jsxs)(p.a,{show:"add"===r,onHide:function(){return i("list")},size:"lg",children:[Object(y.jsx)(p.a.Header,{closeButton:!0,children:Object(y.jsx)(p.a.Title,{children:"Utw\xf3rz ticket"})}),Object(y.jsx)(p.a.Body,{children:Object(y.jsx)(w,{user:t,onAdd:function(e){d([e].concat(Object(j.a)(o))),i("list"),g("added")}})})]})]})},I=function(e){var t=e.onLogin,n=Object(a.useState)(""),c=Object(s.a)(n,2),r=c[0],i=c[1],u=Object(a.useState)(""),o=Object(s.a)(u,2),d=o[0],j=o[1],b=Object(a.useState)(!1),p=Object(s.a)(b,2),f=p[0],m=p[1],k=Object(a.useState)(null),w=Object(s.a)(k,2),N=w[0],S=w[1];return Object(y.jsx)("div",{className:"Login",children:Object(y.jsxs)(g.a,{noValidate:!0,validated:f,onSubmit:function(){var e=Object(x.a)(O.a.mark((function e(n){var a,c,i;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.preventDefault(),n.currentTarget.checkValidity()){e.next=4;break}return m(!0),e.abrupt("return");case 4:return e.prev=4,c=new l.a({auth:d}),e.next=8,c.request("GET /user");case 8:i=e.sent,m(!1),r!==i.data.login?S("Nieprawid\u0142owe dane logowania."):(null===(a=i.headers["x-oauth-scopes"])||void 0===a?void 0:a.split(", ").includes("gist"))?t(i.data.login,d):S('Token nie ma uprawnienia "gist".'),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(4),m(!1),401===e.t0.status?S("Nieprawid\u0142owe dane logowania."):500===e.t0.status?S("Nieudane po\u0142\u0105czenie z serwerem."):S("Wyst\u0105pi\u0142 b\u0142\u0105d. (".concat(e.t0.status," ").concat(e.t0.message,")"));case 17:case"end":return e.stop()}}),e,null,[[4,13]])})));return function(t){return e.apply(this,arguments)}}(),children:[Object(y.jsxs)(g.a.Group,{className:"mb-3",controlId:"Login-username",children:[Object(y.jsx)(g.a.Label,{children:"Nazwa u\u017cytkownika"}),Object(y.jsx)(g.a.Control,{type:"text",value:r,onChange:function(e){return i(e.target.value)},required:!0})]}),Object(y.jsxs)(g.a.Group,{className:"mb-3",controlId:"Login-token",children:[Object(y.jsx)(g.a.Label,{children:"Klucz API"}),Object(y.jsx)(g.a.Control,{type:"password",value:d,onChange:function(e){return j(e.target.value)},required:!0})]}),null!==N&&Object(y.jsx)(h.a,{variant:"danger",children:N}),Object(y.jsx)("div",{className:"text-center",children:Object(y.jsx)(v.a,{variant:"primary",type:"submit",children:"Zaloguj"})})]})})},A=function(){var e=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:localStorage,c=Object(a.useState)((function(){var a=n.getItem(e);return null!==a?JSON.parse(a):t})),r=Object(s.a)(c,1)[0];return Object(a.useEffect)((function(){null!==r?n.setItem(e,JSON.stringify(r)):n.removeItem(e)}),[e,r,n]),c}("credentials",null),t=Object(s.a)(e,2),n=t[0],c=t[1];return Object(y.jsx)("div",{className:"App-wrapper",children:Object(y.jsxs)("div",{className:"App",children:[Object(y.jsx)(u.a,{variant:"light",bg:"light",expand:"sm",className:"mb-3",children:Object(y.jsxs)(o.a,{children:[Object(y.jsx)(u.a.Brand,{children:"Tickety"}),null!==n&&Object(y.jsxs)(y.Fragment,{children:[Object(y.jsx)(u.a.Toggle,{}),Object(y.jsxs)(u.a.Collapse,{className:"justify-content-end",children:[Object(y.jsxs)(u.a.Text,{children:["U\u017cytkownik: ",n.name]}),Object(y.jsx)(d.a,{children:Object(y.jsx)(d.a.Link,{onClick:function(){return c(null)},children:"Wyloguj"})})]})]})]})}),null!==n?Object(y.jsx)(L,{user:{name:n.name,octokit:new l.a({auth:n.token})}}):Object(y.jsx)(I,{onLogin:function(e,t){c({name:e,token:t})}})]})})},q=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,94)).then((function(t){var n=t.getCLS,a=t.getFID,c=t.getFCP,r=t.getLCP,i=t.getTTFB;n(e),a(e),c(e),r(e),i(e)}))};i.a.render(Object(y.jsx)(c.a.StrictMode,{children:Object(y.jsx)(A,{})}),document.getElementById("root")),q()}},[[83,1,2]]]);
//# sourceMappingURL=main.2139249b.chunk.js.map